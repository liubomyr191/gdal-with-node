environment:
  AWS_ACCESS_KEY_ID:
    secure: ihP9C8AMdicFGeffdKqgNG1O4n68jDHQPAZCB/IfuZg=
  AWS_SECRET_ACCESS_KEY:
    secure: G45Qz4paCV4VpsA939dz7i2PQiTdVOYwh1paZ3sGSdS9REKnLHB2cmToak8uAyHP
  matrix:
    - nodejs_version: "0.8.26"
    - nodejs_version: "0.10.29"
    # - nodejs_version: "0.11.13"

platform:
  - x86
  - x64

install:
  - SET PATH=C:\Program Files\7-Zip;%PATH%
  - SET PATH=C:\Python27;%PATH%
  - SET PATH=C:\Program Files (x86)\MSBuild\12.0\bin\;%PATH%
  - ps: Write-Output '$env:Platform:' $env:Platform
  - ps: Write-Output '$env:nodejs_version' $env:nodejs_version
  - ps: Start-FileDownload "https://mapnik.s3.amazonaws.com/dist/dev/libgdal_win_$env:Platform.7z"
  - 7z x libgdal_win_%PLATFORM%.7z
  - ps: Update-NodeJsInstallation $env:nodejs_version $env:Platform
  - node --version
  - npm --version
  # because node-gyp bundled with node 0.8 doesn't know about --msvs_version=2013
  - npm install node-gyp
  - npm install --build-from-source --msvs_version=2013 --shared_gdal=c:/projects/node-gdal/libs/
  - npm test
  - node_modules\.bin\node-pre-gyp package
  - SET CM=%APPVEYOR_REPO_COMMIT_MESSAGE%
  - ECHO commit message %CM%
  - if not "%CM%" == "%CM:[publish binary]=%" node_modules\.bin\node-pre-gyp publish

build: OFF
test: OFF
test_script: OFF
deploy: OFF